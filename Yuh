-- Function to create a random color
function getRandomColor()
    return Color3.new(math.random(), math.random(), math.random())
end

-- Create the ESP outline function
function createESP(player)
    -- Outline part
    local espOutline = Instance.new("Highlight")
    espOutline.Name = "ESPOutline"
    espOutline.Adornee = player.Character
    espOutline.FillTransparency = 1
    espOutline.OutlineTransparency = 0
    espOutline.OutlineColor = Color3.new(1, 0, 0) -- Red color
    espOutline.Parent = player.Character

    -- Name tag part
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Name = "ESPName"
    billboardGui.Adornee = player.Character.Head
    billboardGui.Size = UDim2.new(0, 100, 0, 20) -- Smaller size
    billboardGui.StudsOffset = Vector3.new(0, 3, 0)
    billboardGui.AlwaysOnTop = true

    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = player.Name
    textLabel.TextColor3 = getRandomColor() -- Random color for each name
    textLabel.TextScaled = true
    textLabel.TextSize = 14
    textLabel.Parent = billboardGui

    billboardGui.Parent = player.Character.Head
end

-- Apply ESP to all players
function applyESPToAllPlayers()
    for _, player in pairs(game.Players:GetPlayers()) do
        if player ~= game.Players.LocalPlayer and player.Character then
            createESP(player)
        end
    end
end

-- Listen for new players joining
game.Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        wait(1) -- Give time for character to load
        createESP(player)
    end)
end)

-- Listen for characters being added to existing players
for _, player in pairs(game.Players:GetPlayers()) do
    player.CharacterAdded:Connect(function(character)
        wait(1) -- Give time for character to load
        createESP(player)
    end)
end

-- Initial ESP application
applyESPToAllPlayers()
