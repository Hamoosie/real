-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

-- Configuration
local SPEED = 30
local ANIMATION_ID = "rbxassetid://507766666" -- Replace with a superhero running animation ID
local SPARK_COLOR = Color3.fromRGB(255, 215, 0) -- Yellow color for sparks

-- Local player
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- Function to create spark effect
local function createSpark()
    local spark = Instance.new("ParticleEmitter")
    spark.Texture = "rbxassetid://243660364" -- Replace with your desired spark texture
    spark.Color = ColorSequence.new(SPARK_COLOR)
    spark.Size = NumberSequence.new(0.5)
    spark.Rate = 100
    spark.Lifetime = NumberRange.new(0.2, 0.5)
    spark.Speed = NumberRange.new(5, 10)
    spark.Acceleration = Vector3.new(0, -10, 0)
    spark.Parent = character.PrimaryPart
    return spark
end

-- Load and play the running animation
local animation = Instance.new("Animation")
animation.AnimationId = ANIMATION_ID
local animationTrack = humanoid:LoadAnimation(animation)

-- Start/Stop running animation and effects based on movement state
humanoid.Running:Connect(function(speed)
    if speed > 0 then
        humanoid.WalkSpeed = SPEED
        if not animationTrack.IsPlaying then
            animationTrack:Play()
        end
        if not character:FindFirstChild("SparkEffect") then
            local spark = createSpark()
            spark.Name = "SparkEffect"
        end
    else
        humanoid.WalkSpeed = 16
        if animationTrack.IsPlaying then
            animationTrack:Stop()
        end
        if character:FindFirstChild("SparkEffect") then
            character.SparkEffect:Destroy()
        end
    end
end)

-- Handle character respawn
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoid = newCharacter:WaitForChild("Humanoid")

    -- Reapply the speed script after respawn
    humanoid.Running:Connect(function(speed)
        if speed > 0 then
            humanoid.WalkSpeed = SPEED
            if not animationTrack.IsPlaying then
                animationTrack:Play()
            end
            if not character:FindFirstChild("SparkEffect") then
                local spark = createSpark()
                spark.Name = "SparkEffect"
            end
        else
            humanoid.WalkSpeed = 16
            if animationTrack.IsPlaying then
                animationTrack:Stop()
            end
            if character:FindFirstChild("SparkEffect") then
                character.SparkEffect:Destroy()
            end
        end
    end)
end)
